# 移动端高德地图功能说明

## 功能概述

在移动端首页的停车区域部分集成了高德地图功能，提供以下特性：

### 主要功能

1. **地图显示切换**
   - 点击"查看地图"按钮显示/隐藏地图
   - 地图高度为300px，适配移动端屏幕
   - 支持地图刷新功能

2. **停车位标记**
   - 根据可用车位数量显示不同颜色的标记点
   - 绿色：充足车位（>5个）
   - 橙色：紧张车位（1-5个）
   - 红色：无可用车位（0个）
   - 点击标记点显示详细信息

3. **附近停车位功能**
   - 点击"查看更多区域"打开附近停车位弹窗
   - 支持获取用户当前位置
   - 按距离排序显示附近停车位
   - 显示距离和剩余车位信息

4. **交互功能**
   - 点击停车区域列表项可在地图上定位
   - 支持地图缩放和平移
   - 响应式设计，适配不同屏幕尺寸

## 技术实现

### 文件结构

```
frontend/src/mobile/
├── utils/
│   └── amap.js          # 移动端高德地图工具类
└── views/
    └── Home.vue         # 首页组件（已集成地图功能）
```

### 核心API

#### amap.js 工具类

- `getAMap()`: 加载高德地图API
- `createParkingMap()`: 创建停车位地图
- `getCurrentLocation()`: 获取用户当前位置
- `calculateDistance()`: 计算两点间距离
- `sortByDistance()`: 按距离排序停车位

#### Home.vue 组件方法

- `toggleMap()`: 切换地图显示
- `initMap()`: 初始化地图
- `refreshMap()`: 刷新地图
- `getNearbyParking()`: 获取附近停车位
- `onLocationClick()`: 处理停车区域点击

## 配置说明

### 高德地图配置

在 `amap.js` 中配置了以下参数：

```javascript
const config = {
    key: '662fd0c2e9883677afb2831fc9bd5cf6', // 高德地图API Key
    version: '2.0',
    plugins: ['AMap.Geocoder', 'AMap.PlaceSearch', 'AMap.Geolocation']
};
```

### 地图样式配置

- 移动端使用2D模式，性能更佳
- 支持触摸缩放和平移
- 禁用滚轮缩放（移动端不适用）
- 自动适应标记点视野

## 使用方式

1. **显示地图**：点击停车区域卡片中的"查看地图"按钮
2. **刷新地图**：点击"刷新"按钮重新加载地图数据
3. **查看附近车位**：点击"查看更多区域"，然后点击"获取附近车位"
4. **定位到具体区域**：点击停车区域列表项

## 注意事项

1. 需要用户授权位置权限才能使用附近停车位功能
2. 地图加载需要网络连接
3. 建议在真机上测试，模拟器可能无法正常获取位置信息
4. 地图标记点会根据实际数据动态更新

## 响应式设计

- 大屏设备（>375px）：地图高度300px
- 小屏设备（≤375px）：地图高度250px
- 超小屏设备（≤320px）：地图高度200px

## 数据来源

地图数据来源于后端API：
- `/location/selectAll` - 获取停车区域信息
- `/parkingLot/selectAll` - 获取车位统计信息

地图标记点会实时反映最新的车位占用情况。
